---
title: "Kimbe Predator Diversity and Abundance Analysis 2019"
author: "Ben Cresswell"
date: "03/05/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


# Set working directory
setwd("~/Science & Education/Ben PhD/Data/Pred Div Analysis")

# Install relevant packages (gdata, vegan etc)
require(gdata)
require(vegan)
require(ggplot2)
require(dplyr)
require(ape)
require(BiodiversityR)
require(graphics)
require(ggdendro)
require(MASS)

```

## Introduction

This Rmd file contains analysis and data visualisation on predator abundance and diversity information gleaned from 30m Diver Operated (Stereo) Video (DOV) transects conducted between May 2018 and March 2019. Surveys were conducted c.20-30m depths by Gemma and Ben Cresswell on 3 distinct habitat types: 

1. Near Shore: Emergent (top between 0-10m deep) reef habitat <5km of nearest shoreline
2. Off Shore: Emergent reef habitat >5km of nearest shoreline
3. Sea Mount: Submerged (top deeper than 15m) pinnacle/sea mount type structures dropping to the bay floor

For each reef type, 4 individual localities were chosen with 5 x transects conducted at each location:

Near Shore

1. Lady Di Reef
2. Madaro Reef
3. Susan's Reef
4. Donna's Reef

Off Shore

1. Otto's Point
2. Ema's Reef
3. Hogu Reef
4. Kimbe Island

Sea Mount:

1. Bradford Shoals
2. Inglis Shoals
3. Joelle's Reef
4. Kimbe Bommie

Thus 60 transects were taken in total, 20 from each habitat type. 

## Abundance

Abundance was analysed as follows: 

```{r}

# Load and manipulate file
pa <- read.csv("PredAbun.csv", header=F)
head(pa)
tail(pa)
pa <- pa[-c(4:43),]
pa <- t(pa)
colnames(pa) <- as.character(unlist(pa[1,]))
pa = pa[-1, ]
rownames(pa) = pa[,1]
pa <- pa[,-1]
pa <- as.data.frame(pa)
pa$TOTAL <- as.numeric(pa$TOTAL)
summary(pa)

# Boxplot for data exploration
par(mfrow=c(1,1))
bp1 <- boxplot(TOTAL ~ REEFTYPE, data = pa,
        names=c("NS", "OS", "SM"), 
        ylab="Richness (No. of Species)",
        main = "Species Abundance",
        col = "grey")
bp1



```




Following video analysis, 9 total transects contained zero counts of predators (and were later removed from the data set for the community analysis). These transects were:

1. Donna T1
2. Susan T2
3. Madaro T2
4. Madaro T5
5. Lady Di T3
6. Lady Di T4
7. Lady Di T5
8. Hogu T5
9. Kimbe Isl T3

Thus sample size for analyis in community dissimilarity was as follows:

Near shore n=13
Off shore n=18
Sea mount n=20

## Load and prep the data

The data frame named pdmain is 60 observations (transects) covering 40 species (variables). The first 3 columns are the unique transects name/#, the site name and reef type. These columns need to be removed in R in order to run diversity analysis in vegan. Here we've done this in a new data frame called pd.

```{r, include=FALSE}

# Set working directory
setwd("~/Science & Education/Ben PhD/Data/Pred Div Analysis")

# Install relevant packages (gdata, vegan etc)
require(gdata)
require(vegan)
require(ggplot2)
require(dplyr)

# Load file
pdmain <- read.csv("PredVeganAll.csv", header = T)
pd <- pdmain

# Set the row names as per column 1 and then remove unnecessary columns:
rownames(pd) = pd[,1]
pd <- pd[,-1]
pd <- pd[,-1]
pd <- pd[,-1]

# Remove transects with all zero entries - ONLY FOR THE VEGAN WORK (to avoid error messages)
pd <- pd[rowSums(pd==0, na.rm=TRUE)<ncol(pd), ]

# Push a data-frame into a vector according to indices (Richness, Shannon-Weiner, Simpson etc) #
pred.rich<-specnumber(pd)
pred.shannon<-diversity(pd)

```


## Initial data exploration

```{r}

par(mfrow=c(1,2))
boxplot(pred.rich[1:13], pred.rich[14:31], pred.rich[32:51],
        names=c("NS", "OS", "SM"), 
        ylab="Richness (No. of Species)",
        main = "Species Richness",
        col = "grey")
boxplot(pred.shannon[1:13], pred.shannon[14:31], pred.shannon[32:51],
        names=c("NS", "OS", "SM"), 
        ylab="Shannon Index",
        main = "H' Diversity",
        col = "grey")
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
